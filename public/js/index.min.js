function scrollToBottom(){var e=jQuery("#messages"),o=e.children("li:last-child"),t=e.prop("clientHeight"),n=e.prop("scrollTop"),r=e.prop("scrollHeight"),s=o.innerHeight(),a=o.prev().innerHeight();n+t+s+a>=r&&e.scrollTop(r)}function showError(e){switch(e.code){case e.PERMISSION_DENIED:console.log("User denied the request for Geolocation.");break;case e.POSITION_UNAVAILABLE:console.log("Location information is unavailable.");break;case e.TIMEOUT:console.log("The request to get user location timed out.");break;case e.UNKNOWN_ERROR:console.log("An unknown error occurred.")}}var socket=io();socket.on("connect",function(){var e=jQuery.deparam(window.location.search);socket.emit("join",e,function(o){o?(alert(o),window.location.href="/"):document.title="ChatBox - "+e.room}),console.log("Connected to server")}),socket.on("newMessage",function(e){var o=moment(e.createdAt).format("h:mm a"),t=jQuery("#message_template").html(),n=Mustache.render(t,{text:e.text,from:e.from,createdAt:o});jQuery("#messages").append(n),scrollToBottom()}),socket.on("newLocationMessage",function(e){var o=moment(e.createdAt).format("h:mm a"),t=jQuery("#location_message_template").html(),n=Mustache.render(t,{url:e.url,from:e.from,createdAt:o});jQuery("#messages").append(n),scrollToBottom()}),socket.on("disconnect",function(){console.log("Disconnected from server")}),socket.on("updateUserList",function(e){console.log("Users list",e);var o=jQuery("<ol></ol>");e.forEach(function(e){o.append(jQuery("<li></li>").text(e))}),jQuery("#users").html(o)});var message_text=jQuery("[name=message]");socket.on("disconnect",function(){console.log("Disconnected from server")}),jQuery("#message_form").on("submit",function(e){e.preventDefault(),socket.emit("createMessageEvent",{text:message_text.val()},function(){message_text.val("")})});var locationbutton=jQuery("#send_location");locationbutton.on("click",function(){navigator.permissions.query({name:"geolocation"}).then(function(e){if("granted"===e.state)locationbutton.attr("disabled","disabled").text("Sending location..."),navigator.geolocation.getCurrentPosition(function(e){locationbutton.removeAttr("disabled").text("Send location"),socket.emit("create_location_message",{latitude:e.coords.latitude,longitude:e.coords.longitude})}),function(e){locationbutton.removeAttr("disabled").text("Send location"),alert("Unable to fetch location"),showError(e)};else{if("prompt"!==e.state)return alert("Geolocation not suppourted by your browser");showButtonToEnableMap()}})});
//# sourceMappingURL=index.min.js.map